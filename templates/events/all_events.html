<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Events</title>
</head>
<body>
    {% if user.is_authenticated %}
        <h2>Welcome, {{ user.username }}!</h2>
    {% endif %}

    <h2>All Events</h2>
    <nav>
        <a href="{% url 'customer_signup' %}">Customer Signup</a>
        <a href="{% url 'customer_login' %}">Customer Login</a>
        <a href="{% url 'signup' %}">Vendor Signup</a>
        <a href="{% url 'login' %}">Vendor Login</a>
        <a href="{% url 'dashboard' %}">Vendor Dashboard</a>
        <a href="{% url 'customer_home' %}">Customer Home</a>
    </nav>

    <h3>Upcoming Events</h3>
    {% if upcoming_events %}
        <ul>
            {% for event in upcoming_events %}
                <li>
                    <h3>{{ event.title }}</h3>
                    <p><strong>Vendor:</strong> {{ event.vendor.first_name }} from {{ event.vendor.storename }}</p>
                    <p><strong>Description:</strong> {{ event.description }}</p>
                    <p><strong>Category:</strong> {{ event.category }}</p>
                    <p><strong>Start Date:</strong> {{ event.start_date|date:"F d, Y" }}</p>
                    <p><strong>End Date:</strong> {{ event.end_date|date:"F d, Y" }}</p>
                    <p><strong>Venue:</strong> {{ event.venue_name }}</p>
                    <p><strong>Regular Price:</strong> {{ event.regular_price }}</p>
                    <p><strong>Sale Price:</strong> {{ event.sale_price }}</p>

                    <p><strong>Tickets Available:</strong> 
                        {% if event.remaining_tickets > 0 %}
                            {{ event.remaining_tickets }}
                        {% else %}
                            <span style="color: red;">Sold Out</span>
                        {% endif %}
                    </p>

                    {% if event.ticket_categories.all %}
                        <h4>Ticket Categories:</h4>
                        <ul>
                            {% for category in event.ticket_categories.all %}
                                <li>
                                    <p><strong>Category Title:</strong> {{ category.category_title }}</p>
                                    <p><strong>Price:</strong> {{ category.category_price }}</p>
                                    <p><strong>Tickets Available:</strong> 
                                        {% if category.remaining_tickets > 0 %}
                                            {{ category.remaining_tickets }}
                                        {% else %}
                                            <span style="color: red;">Sold Out</span>
                                        {% endif %}
                                    </p>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No ticket categories available.</p>
                    {% endif %}

                    {% if event.poster %}
                        <p><img src="{{ event.poster.url }}" alt="{{ event.title }}" width="200"></p>
                    {% else %}
                        <p>No image available</p>
                    {% endif %}

                    {% if event.remaining_tickets == 0 %}
                        <p><strong>Status:</strong> Sold Out</p>
                    {% else %}
                        {% if event.remaining_tickets <= 5 %}
                            <p><strong>Hurry!</strong> Only a few tickets left!</p>
                        {% endif %}
                        <p><a href="{% url 'buy_ticket' event.id %}">Get Tickets</a></p>

                        <form method="post" action="{% url 'add_to_cart' event.id %}">
                            {% csrf_token %}
                            <button type="submit">Add to Cart</button>
                        </form>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No upcoming events available.</p>
    {% endif %}

    <h3>Other Events</h3>
    {% if other_events %}
        <ul>
            {% for event in other_events %}
                <li>
                    <!-- Reuse the same event structure here -->
                    <!-- ... -->
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No other events available.</p>
    {% endif %}
</body>
</html>
