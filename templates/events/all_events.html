<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>All Events</title>
</head>
<body>
    {% if user.is_authenticated %}
        <h2>Welcome, {{ user.username }}!</h2>
        <form method="post" action="{% url 'logout' %}">
            {% csrf_token %}
            <button type="submit">Logout</button>
        </form>
    {% endif %}

    <h2>All Events</h2>

    {% if events %}
        <ul>
            {% for event in events %}
                <li>
                    <h3>{{ event.title }}</h3>
                    <p><strong>Vendor:</strong> {{ event.vendor.first_name }} from {{ event.vendor.storename }}</p>
                    <p><strong>Description:</strong> {{ event.description }}</p>
                    <p><strong>Category:</strong> {{ event.category }}</p>
                    <p><strong>Start Date:</strong> {{ event.start_date|date:"F d, Y" }}</p>
                    <p><strong>End Date:</strong> {{ event.end_date|date:"F d, Y" }}</p>
                    <p><strong>Venue:</strong> {{ event.venue_name }}</p>
                    <p><strong>Regular Price:</strong> {{ event.regular_price }}</p>
                    <p><strong>Sale Price:</strong> {{ event.sale_price }}</p>
                    <p><strong>Tickets Available:</strong> {{ event.tickets_available }}</p>

                    {% if event.ticket_categories.all %}
                        <h4>Ticket Categories:</h4>
                        <ul>
                            {% for category in event.ticket_categories.all %}
                                <li>
                                    <p><strong>Category Title:</strong> {{ category.category_title }}</p>
                                    <p><strong>Price:</strong> {{ category.category_price }}</p>
                                    <p><strong>Tickets Available:</strong> {{ category.category_tickets_available }}</p>
                                </li>
                            {% endfor %}
                        </ul>
                    {% else %}
                        <p>No ticket categories available.</p>
                    {% endif %}

                    {% if event.poster %}
                        <p><img src="{{ event.poster.url }}" alt="{{ event.title }}" width="200"></p>
                    {% else %}
                        <p>No image available</p>
                    {% endif %}
                    
                    {% if event.is_sold_out %}
                    <p><strong>Status:</strong> Sold Out</p>
                {% else %}
                    <p><a href="{% url 'buy_ticket' event.id %}">Get Tickets</a></p>
                {% endif %}

                    {% if user.is_authenticated %}
                        <form method="post" action="{% url 'add_to_cart' event.id %}">
                            {% csrf_token %}
                            <button type="submit">Add to Cart</button>
                        </form>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p>No events available.</p>
    {% endif %}
</body>
</html>
