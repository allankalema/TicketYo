{% extends 'frontend/base.html' %}


{%load static %}
{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Welcome to the POS Dashboard</h1>
    <p class="text-center">You are logged in as {{ request.user.username }}.</p>

    <!-- Profile Dropdown Menu -->
    <div class="dropdown text-right">
        <button class="btn btn-outline-danger dropdown-toggle" type="button" id="profileDropdown"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Profile
        </button>
        <!-- Ensuring dropdown menu aligns to the right -->
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="profileDropdown">
            <a class="dropdown-item" href="{% url 'update_pos_agent_profile' %}">Update Profile</a>
            <a class="dropdown-item" href="{% url 'change_password' %}">Change Password</a>
            <a class="dropdown-item" href="{% url 'universal_logout' %}">Logout</a>
        </div>
    </div>

    <!-- Assigned Events Section -->
    <h3 class="mt-5">Your Assigned Events</h3>

    {% if assignments %}
        <div class="row mt-4">
            {% for assignment in assignments %}
                <div class="col-md-4 mb-4">
                    <div class="card">
                        <!-- Event poster image -->
                        {% if assignment.event.poster %}
                            <img src="{{ assignment.event.poster.url }}" class="card-img-top" alt="{{ assignment.event.title }}">
                        {% else %}
                            <img src="{% static 'images/default-poster.jpg' %}" class="card-img-top" alt="Event Poster">
                        {% endif %}
                        
                        <div class="card-body text-center">
                            <!-- Event title -->
                            <h5 class="card-title">{{ assignment.event.title }}</h5>
                        </div>

                        <!-- Entire card clickable, linking to event details -->
                        <a href="#" class="stretched-link"></a>
                    </div>
                </div>
            {% endfor %}
        </div>
    {% else %}
        <p class="text-muted">No events assigned to you yet.</p>
    {% endif %}
</div>

<script>
    // Dropdown functionality
    document.addEventListener('DOMContentLoaded', function () {
        const dropdownButton = document.getElementById('profileDropdown');
        const dropdownMenu = document.querySelector('.dropdown-menu');

        if (dropdownButton && dropdownMenu) {
            dropdownButton.addEventListener('click', function (event) {
                dropdownMenu.classList.toggle('show');
                event.stopPropagation(); // Prevent event from bubbling up
            });

            document.addEventListener('click', function (event) {
                if (!dropdownButton.contains(event.target) && !dropdownMenu.contains(event.target)) {
                    dropdownMenu.classList.remove('show');
                }
            });
        }
    });
</script>
{% endblock %}
