{% extends 'frontend/base.html' %}

{% block content %}
<div class="container mt-5">
    <h1 class="text-center">Welcome to the POS Dashboard</h1>
    <p class="text-center">You are logged in as {{ request.user.username }}.</p>

    <!-- Profile Dropdown Menu -->
    <div class="dropdown text-right">
        <button class="btn btn-outline-danger dropdown-toggle" type="button" id="profileDropdown"
            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Profile
        </button>
        <!-- Ensuring dropdown menu aligns to the right -->
        <div class="dropdown-menu dropdown-menu-right" aria-labelledby="profileDropdown">
            <a class="dropdown-item" href="{% url 'update_pos_agent_profile' %}">Update Profile</a>
            <a class="dropdown-item" href="{% url 'change_password' %}">Change Password</a>
            <a class="dropdown-item" href="{% url 'universal_logout' %}">Logout</a>
        </div>
    </div>

    <!-- Assigned Events Section -->
    <h3 class="mt-5">Your Assigned Events</h3>

    {% if assignments %}
        <ul class="list-group mt-4">
            {% for assignment in assignments %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                    <!-- Event title as clickable (using '#' for now) -->
                    <a href="#" class="event-title">{{ assignment.event.title }}</a>
                    <!-- Display the date the event was assigned -->
                    <span class="badge badge-primary">{{ assignment.created_at|date:"Y-m-d" }}</span>
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-muted">No events assigned to you yet.</p>
    {% endif %}
</div>

<script>
    // Dropdown functionality
    document.addEventListener('DOMContentLoaded', function () {
        const dropdownButton = document.getElementById('profileDropdown');
        const dropdownMenu = document.querySelector('.dropdown-menu');

        if (dropdownButton && dropdownMenu) {
            dropdownButton.addEventListener('click', function (event) {
                dropdownMenu.classList.toggle('show');
                event.stopPropagation(); // Prevent event from bubbling up
            });

            document.addEventListener('click', function (event) {
                if (!dropdownButton.contains(event.target) && !dropdownMenu.contains(event.target)) {
                    dropdownMenu.classList.remove('show');
                }
            });
        }
    });
</script>
{% endblock %}
